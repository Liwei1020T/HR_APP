// This is your Prisma schema file
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  EMPLOYEE
  HR
  ADMIN
  SUPERADMIN
}

enum FeedbackStatus {
  SUBMITTED
  UNDER_REVIEW
  IN_PROGRESS
  RESOLVED
  CLOSED
}

enum FeedbackCategory {
  GENERAL
  WORKPLACE
  MANAGEMENT
  BENEFITS
  CULTURE
  OTHER
}

enum AnnouncementCategory {
  COMPANY_NEWS
  HR_POLICY
  EVENT
  BENEFIT
  TRAINING
  OTHER
}

enum NotificationType {
  FEEDBACK
  ANNOUNCEMENT
  CHANNEL
  SYSTEM
}

enum MemberRole {
  MEMBER
  MODERATOR
}

model User {
  id                      Int                    @id @default(autoincrement())
  email                   String                 @unique
  password                String
  fullName                String                 @map("full_name")
  role                    UserRole               @default(EMPLOYEE)
  department              String?
  isActive                Boolean                @default(true) @map("is_active")
  createdAt               DateTime               @default(now()) @map("created_at")
  updatedAt               DateTime               @updatedAt @map("updated_at")
  
  // Relations
  channelsCreated         Channel[]              @relation("ChannelCreator")
  memberships             ChannelMember[]
  feedbackSubmitted       Feedback[]             @relation("FeedbackSubmitter")
  feedbackAssigned        Feedback[]             @relation("FeedbackAssignee")
  feedbackComments        FeedbackComment[]
  notifications           Notification[]
  announcementsCreated    Announcement[]
  filesUploaded           File[]
  auditLogs               AuditLog[]

  @@map("users")
}

model Channel {
  id                      Int                    @id @default(autoincrement())
  name                    String                 @db.VarChar(100)
  description             String?                @db.VarChar(500)
  channelType             String                 @default("general") @map("channel_type") @db.VarChar(50)
  isPrivate               Boolean                @default(false) @map("is_private")
  createdBy               Int                    @map("created_by")
  createdAt               DateTime               @default(now()) @map("created_at")
  updatedAt               DateTime               @updatedAt @map("updated_at")
  
  // Relations
  creator                 User                   @relation("ChannelCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  members                 ChannelMember[]

  @@index([createdBy])
  @@map("channels")
}

model ChannelMember {
  id                      Int                    @id @default(autoincrement())
  userId                  Int                    @map("user_id")
  channelId               Int                    @map("channel_id")
  role                    MemberRole             @default(MEMBER)
  joinedAt                DateTime               @default(now()) @map("joined_at")
  
  // Relations
  user                    User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
  channel                 Channel                @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@unique([userId, channelId])
  @@index([userId])
  @@index([channelId])
  @@map("channel_members")
}

model Feedback {
  id                      Int                    @id @default(autoincrement())
  title                   String                 @db.VarChar(255)
  description             String                 @db.Text
  category                FeedbackCategory       @default(GENERAL)
  status                  FeedbackStatus         @default(SUBMITTED)
  isAnonymous             Boolean                @default(false) @map("is_anonymous")
  submittedBy             Int                    @map("submitted_by")
  assignedTo              Int?                   @map("assigned_to")
  createdAt               DateTime               @default(now()) @map("created_at")
  updatedAt               DateTime               @updatedAt @map("updated_at")
  
  // Relations
  submitter               User                   @relation("FeedbackSubmitter", fields: [submittedBy], references: [id], onDelete: Cascade)
  assignee                User?                  @relation("FeedbackAssignee", fields: [assignedTo], references: [id], onDelete: SetNull)
  comments                FeedbackComment[]
  files                   File[]

  @@index([submittedBy])
  @@index([assignedTo])
  @@index([status])
  @@map("feedback")
}

model FeedbackComment {
  id                      Int                    @id @default(autoincrement())
  feedbackId              Int                    @map("feedback_id")
  userId                  Int                    @map("user_id")
  comment                 String                 @db.Text
  isInternal              Boolean                @default(false) @map("is_internal")
  createdAt               DateTime               @default(now()) @map("created_at")
  
  // Relations
  feedback                Feedback               @relation(fields: [feedbackId], references: [id], onDelete: Cascade)
  user                    User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([feedbackId])
  @@index([userId])
  @@map("feedback_comments")
}

model Notification {
  id                      Int                    @id @default(autoincrement())
  userId                  Int                    @map("user_id")
  type                    NotificationType
  title                   String                 @db.VarChar(255)
  message                 String                 @db.Text
  isRead                  Boolean                @default(false) @map("is_read")
  relatedEntityType       String?                @map("related_entity_type") @db.VarChar(50)
  relatedEntityId         Int?                   @map("related_entity_id")
  createdAt               DateTime               @default(now()) @map("created_at")
  
  // Relations
  user                    User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([isRead])
  @@map("notifications")
}

model Announcement {
  id                      Int                    @id @default(autoincrement())
  title                   String                 @db.VarChar(255)
  content                 String                 @db.Text
  category                AnnouncementCategory   @default(OTHER)
  isPinned                Boolean                @default(false) @map("is_pinned")
  isActive                Boolean                @default(true) @map("is_active")
  expiresAt               DateTime?              @map("expires_at")
  createdBy               Int                    @map("created_by")
  createdAt               DateTime               @default(now()) @map("created_at")
  updatedAt               DateTime               @updatedAt @map("updated_at")
  
  // Relations
  creator                 User                   @relation(fields: [createdBy], references: [id], onDelete: Cascade)
  files                   File[]

  @@index([createdBy])
  @@index([isActive])
  @@map("announcements")
}

model File {
  id                      Int                    @id @default(autoincrement())
  filename                String                 @db.VarChar(255)
  filePath                String                 @map("file_path") @db.VarChar(500)
  fileType                String                 @map("file_type") @db.VarChar(100)
  fileSize                Int                    @map("file_size")
  uploadedBy              Int                    @map("uploaded_by")
  entityType              String?                @map("entity_type") @db.VarChar(50)
  entityId                Int?                   @map("entity_id")
  feedbackId              Int?                   @map("feedback_id")
  announcementId          Int?                   @map("announcement_id")
  createdAt               DateTime               @default(now()) @map("created_at")
  
  // Relations
  uploader                User                   @relation(fields: [uploadedBy], references: [id], onDelete: Cascade)
  feedback                Feedback?              @relation(fields: [feedbackId], references: [id], onDelete: SetNull)
  announcement            Announcement?          @relation(fields: [announcementId], references: [id], onDelete: SetNull)

  @@index([uploadedBy])
  @@index([feedbackId])
  @@index([announcementId])
  @@map("files")
}

model AuditLog {
  id                      Int                    @id @default(autoincrement())
  userId                  Int?                   @map("user_id")
  action                  String                 @db.VarChar(100)
  entityType              String?                @map("entity_type") @db.VarChar(50)
  entityId                Int?                   @map("entity_id")
  details                 String?                @db.Text
  ipAddress               String?                @map("ip_address") @db.VarChar(50)
  createdAt               DateTime               @default(now()) @map("created_at")
  
  // Relations
  user                    User?                  @relation(fields: [userId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([entityType])
  @@index([createdAt])
  @@map("audit_logs")
}
